<!DOCTYPE html>
<html  lang="zh_CN" xmlns:th="http://www.thymeleaf.org"
       xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>欢迎页</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
<div class="panel panel-default">
    <div class="panel-heading">了解微库平台</div>
    <div style="padding: 10px 0 20px 10px;">
        <h3>&nbsp;&nbsp;&nbsp;项目介绍</h3>
        <ul>
  <!--          <li>用户注册平台账户后，通过扫描二维码或导入数据的方式将微信号绑定到自己账户下面.</li>
            <li>平台使用用户绑定的微信号做任务，完成任务微信号获得佣金直接汇总到用户平台账户上.</li>
            <li>用户发起佣金提现，提现金额将在3个工作日内到账,用户获得现金收益.</li>-->

            <!--<button type="button"-->
                    <!--class="btn  btn-primary" onclick="getQRCode()">-->
                <!--<i class="fa fa-plus" aria-hidden="true"></i>获取二维码-->
            <!--</button>-->
            <input type="hidden" id="randomId" name="randomId"></input>
            <div id="qrcodeUUID"></div>
            <img id="qrImg" src="" width="150px" height="150px" alt="微信登录二维码" />


        </ul>
    </div>
    <div style="padding: 10px 0 20px 10px;">
        <h3>&nbsp;&nbsp;&nbsp;WeChat Business Button</h3>
        <ul>
            <li><input type="button" id="getQrCode" name="getQrCode" onclick="getQrCode()" value="获取二维码"/> </li>
            <li><input type="button" id="getQrCodeStatus" name="getQrCode" onclick="getQrCodeStatus()" value="获取二维码状态"/> </li>
            <li><input type="button" id="getLoginStatus" name="getLoginStatus" onclick="getLoginStatus()" value="获取登录状态"/> </li>
            <li><input type="button" id="getReadReady" name="getReadReady" onclick="getReadReady()" value="获取阅读准备数据"/> </li>
            <li><input type="button" id="contactOperateService" name="contactOperateService" onclick="contactOperateService()" value="关注公众号"/> </li>
            <li>
                <input type="button" id="upload62" name="upload62" onclick="upload62()" value="上传62TXT"/>
                <input type="hidden" id="62DataUrl" name="62DataUrl"/>
                <input type="button" id="解析62数据" name="upload62" onclick="parse62()" value="解析62数据"/>
                <br/>选择文件:<input type="file" id="file1" />
            </li>

            <li><input type="button" id="addUser" name="addUser" onclick="addUser()" value="new关注公众号"/> </li>
        </ul>
    </div>
</div>
</body>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/openTab.js"></script>
<script th:inline="javascript"> var ctx = [[@{/}]] ; </script>
<script type="text/javascript">
    var ind = "";

    function parse62(){
        var parUrl=$("#62DataUrl").val();
        if (parUrl != null && parUrl != undefined) {
            $.ajax({
                type: 'POST',
                url: "/wx/wxoperation/parse62Data",
                data:{url: parUrl},
                success: function (data) {
                    console.info(data);
                    if (data != null) {
                        $("#qrcodeUUID").html(data.uuid);
                        $("#randomId").val(data.uuid);
                        var qrImg=data.data.retdata;
                        console.info(qrImg);
                        if (qrImg != null&&qrImg!='') {
                            $("#qrImg").attr('src',qrImg);
                        }
                    }
                },
                dataType: "JSON"
            });
        }else {
            alert(0)
        }
    }

    function upload62(){
        var formData = new FormData();
        var fi=document.getElementById("file1").files[0];
        if (fi!=null){
            formData.append("myfile", fi);
            $.ajax({
                url: "/wx/wxoperation/upload62",
                type: "POST",
                data: formData,
                /**
                 *必须false才会自动加上正确的Content-Type
                 */
                contentType: false,
                /**
                 * 必须false才会避开jQuery对 formdata 的默认处理
                 * XMLHttpRequest会对 formdata 进行正确的处理
                 */
                processData: false,
                success: function (data) {
                    if (data != "") {
                        alert("上传成功！");
                        $("#62DataUrl").val(data);
                        document.getElementById("file1").files[0] = "";
                    }else{
                        alert(data.msg);
                        document.getElementById("file1").files[0] = "";
                    }

                },
                error: function () {
                    alert("上传失败！");
                    document.getElementById("file1").files[0] = "";
                }
            });
        }
    }

    function getQrCode(){
        $.ajax({
            type: 'POST',
            contentType:"application/json;charset=utf-8",
            url: "/wx/wxoperation/login_qrcode",
            data:JSON.stringify({
                randomId: "asdf54wq6qwqerqwer1aas512312544654asdqw",
                account: "asd",
                softwareId: "666",
                autoLogin: true,
                protocolVer: 3,
                extraData: null,
                cmd: 502,
                now: new Date().getTime() // 注意不要在此行增加逗号
            }),
            success: function (data) {
                console.info(data);
                if (data != null) {
                    $("#qrcodeUUID").html(data.uuid);
                    $("#randomId").val(data.uuid);
                    var qrImg=data.data.retdata;
                    console.info(qrImg);
                    if (qrImg != null&&qrImg!='') {
                        $("#qrImg").attr('src',qrImg);
                    }
                }
            },
            dataType: "JSON"
        });
    }

    function getQrCodeStatus(){
        $.ajax({
            type: 'POST',
            contentType:"application/json;charset=utf-8",
            url: "/wx/wxoperation/login_status",
            data:JSON.stringify({
                randomId: $("#randomId").val(),
                account: "asd",
                softwareId: "666",
                autoLogin: true,
                extraData: null,
                protocolVer: 3,
                cmd: 6666,
                now: new Date().getTime() // 注意不要在此行增加逗号
            }),
            success: function (data) {
                if (data != null&&data.code==0) {
                    var qrImg=data.status.state.ImgBuf;
                    console.info(qrImg);
                    if (qrImg != null&&qrImg!='') {
                        qrImg = 'data:image/png;base64,' + qrImg;
                        $("#qrImg").attr('src',qrImg);
                        clearInterval(ind);
                    }
                }
            },
            dataType: "JSON"
        });
    }

    function getReadReady(){
        $.ajax({
            type: 'POST',
            contentType:"application/json;charset=utf-8",
            url: "/wx/wxoperation/getReadReady",
            data:JSON.stringify({
                randomId: $("#randomId").val(),
                account: "asd",
                softwareId: "666",
                autoLogin: true,
                extraData: null,
                protocolVer: 3,
                reqUrl: "https://mp.weixin.qq.com/s/kRFDHvA3HK6R9p3ATq-auA",
                scene: "7",
                username: "yindongli2018",
                cmd: 777,
                now: new Date().getTime() // 注意不要在此行增加逗号
            }),
            success: function (data) {
                if (data != null&&data.code==0) {
                    var qrImg=data.status.state.ImgBuf;
                    console.info(qrImg);
                    if (qrImg != null&&qrImg!='') {
                        qrImg = 'data:image/png;base64,' + qrImg;
                        $("#qrImg").attr('src',qrImg);
                        clearInterval(ind);
                    }
                }
            },
            dataType: "JSON"
        });
        // $.post("?randomId="+$("#randomId").val()+"&reqUrl=https://mp.weixin.qq.com/s/ExMUO0KuWwNyqdfgIwTw8A&scene=7&username=yindongli2018",function (data) {
        //     if (data != null&&data.code==0) {
        //         console.info(data);
        //     }
        // });
    }

    function getUpload62(){
        $.post("/wx/wxoperation/getLoginStatus?randomId="+$("#randomId").val(),function (data) {
            if (data != null&&data.code==0) {
                console.info(data);
            }
        });
    }

    function getLoginStatus(){
        $.post("/wx/wxoperation/getLoginStatus?randomId="+$("#randomId").val(),function (data) {
            if (data != null&&data.code==0) {
                console.info(data);
            }
        });
    }

    function contactOperateService(){
        $.post("/wx/wxoperation/contactOperateService?randomId="+$("#randomId").val(),function (data) {
            if (data != null&&data.code==0) {
                console.info(data);
            }
        });
    }

    function addUser(){
        $.ajax({
            type: 'POST',
            contentType:"application/json;charset=utf-8",
            url: "/wx/wxoperation/addUser",
            data:JSON.stringify({
                randomId: $("#randomId").val(),
                account: "asd",
                softwareId: "666",
                autoLogin: true,
                extraData: null,
                protocolVer: 3,
                reqUrl: "https://mp.weixin.qq.com/s/O4cvFKd0cCwnTybRZAGm6g",
                scene: "3",
                username: "yindongli2018",
                gzwxId:"caozhi163",
                cmd: 999,
                now: new Date().getTime() // 注意不要在此行增加逗号
            }),
            success: function (data) {
                if (data != null&&data.code==0) {
                    var qrImg=data.status.state.ImgBuf;
                    console.info(qrImg);
                    if (qrImg != null&&qrImg!='') {
                        qrImg = 'data:image/png;base64,' + qrImg;
                        $("#qrImg").attr('src',qrImg);
                        clearInterval(ind);
                    }
                }
            },
            dataType: "JSON"
        });
    }
</script>
</html>